<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>清晏小站 · 桃李春風</title>
  <meta name="description" content="清晏小站 - 一處古風雅致的互動站點，寄語心語，錦書長信，節日賀卡。">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+TC:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>

  <style>
    /* ==================== CSS Variables ==================== */
    :root {
      --color-ink: #3a2d22;
      --color-ink-light: #5c4033;
      --color-muted: #6e6258;
      --color-paper: #fffef9;
      --color-paper-alpha: rgba(255, 254, 249, 0.92);
      --color-brand: #8c6b5d;
      --color-brand-deep: #5c4033;
      --color-red: #c8372d;
      --color-bamboo: #5a8776;
      --color-moon: #f5e6d3;
      --shadow-soft: 0 8px 24px rgba(0, 0, 0, 0.08);
      --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.12);
      --transition-fast: 0.3s ease;
      --transition-normal: 0.5s ease;
    }

    /* ==================== Reset & Base ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Noto Serif TC', serif;
      color: var(--color-ink);
      background: linear-gradient(135deg, #f4f1ea 0%, #e8dfd0 100%);
      background-attachment: fixed;
      min-height: 100vh;
      line-height: 1.8;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* ==================== Password Gate ==================== */
    #password-gate {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #f4f1ea 0%, #e8dfd0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.8s ease;
    }

    #password-gate.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .gate-card {
      background: var(--color-paper-alpha);
      padding: 48px 40px;
      border-radius: 16px;
      box-shadow: var(--shadow-soft);
      text-align: center;
      max-width: 420px;
      width: 90%;
      backdrop-filter: blur(10px);
    }

    .gate-title {
      font-family: 'Ma Shan Zheng', cursive;
      font-size: 2.4rem;
      color: var(--color-brand-deep);
      margin-bottom: 16px;
    }

    .gate-subtitle {
      color: var(--color-muted);
      font-size: 1rem;
      margin-bottom: 32px;
    }

    .gate-input-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .gate-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #d4c4b0;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color var(--transition-fast);
    }

    .gate-input:focus {
      border-color: var(--color-brand);
      box-shadow: 0 0 0 4px rgba(140, 107, 93, 0.1);
    }

    .gate-button {
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--color-brand), var(--color-brand-deep));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
      font-family: inherit;
    }

    .gate-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(92, 64, 51, 0.3);
    }

    .gate-button:active {
      transform: translateY(0);
    }

    .gate-error {
      color: var(--color-red);
      font-size: 0.9rem;
      margin-top: 12px;
      opacity: 0;
      transition: opacity var(--transition-fast);
    }

    .gate-error.show {
      opacity: 1;
    }

    /* ==================== Main Layout ==================== */
    #main-app {
      opacity: 0;
      transition: opacity 0.8s ease;
    }

    #main-app.show {
      opacity: 1;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* ==================== Navigation Bar ==================== */
    .nav-bar {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 16px 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-soft);
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .nav-item {
      padding: 12px 24px;
      background: transparent;
      border: 2px solid transparent;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--color-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Ma Shan Zheng', cursive;
    }

    .nav-item:hover {
      color: var(--color-brand-deep);
      background: rgba(140, 107, 93, 0.1);
    }

    .nav-item.active {
      color: var(--color-brand-deep);
      border-color: var(--color-brand);
      background: rgba(140, 107, 93, 0.15);
    }

    .nav-icon {
      width: 20px;
      height: 20px;
    }

    /* ==================== Content Area ==================== */
    .content-area {
      position: relative;
      min-height: 500px;
    }

    .content-panel {
      position: absolute;
      width: 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-normal);
    }

    .content-panel.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* ==================== Module: 轩窗 (Messages) ==================== */
    .message-card {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 48px 40px;
      box-shadow: var(--shadow-soft);
      text-align: center;
      max-width: 700px;
      margin: 0 auto;
      position: relative;
    }

    .message-content {
      font-size: 1.8rem;
      line-height: 2.2;
      color: var(--color-ink);
      margin-bottom: 32px;
      font-weight: 500;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .message-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--color-muted);
      font-size: 1rem;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid rgba(92, 64, 51, 0.2);
    }

    .message-refresh {
      padding: 10px 20px;
      background: var(--color-brand);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-family: inherit;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 24px auto 0;
    }

    .message-refresh:hover {
      background: var(--color-brand-deep);
      transform: translateY(-2px);
    }

    /* ==================== Module: 锦书 (Letters) ==================== */
    .letters-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .letters-list {
      display: grid;
      gap: 16px;
    }

    .letter-item {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 24px;
      box-shadow: var(--shadow-card);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 2px solid transparent;
    }

    .letter-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      border-color: var(--color-brand);
    }

    .letter-title {
      font-size: 1.4rem;
      color: var(--color-brand-deep);
      margin-bottom: 8px;
      font-family: 'Ma Shan Zheng', cursive;
    }

    .letter-date {
      color: var(--color-muted);
      font-size: 0.9rem;
      margin-bottom: 12px;
    }

    .letter-preview {
      color: var(--color-ink-light);
      font-size: 1rem;
      line-height: 1.6;
    }

    /* Letter Detail View */
    .letter-detail {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 48px;
      box-shadow: var(--shadow-soft);
      max-width: 800px;
      margin: 0 auto;
    }

    .letter-detail-header {
      text-align: center;
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 2px solid rgba(92, 64, 51, 0.2);
    }

    .letter-detail-title {
      font-size: 2rem;
      color: var(--color-brand-deep);
      margin-bottom: 12px;
      font-family: 'Ma Shan Zheng', cursive;
    }

    .letter-detail-date {
      color: var(--color-muted);
      font-size: 1rem;
    }

    .letter-detail-content {
      writing-mode: vertical-rl;
      text-orientation: upright;
      line-height: 2.4;
      font-size: 1.2rem;
      color: var(--color-ink);
      min-height: 500px;
      padding: 20px;
      direction: rtl;
    }

    .letter-detail-content h1,
    .letter-detail-content h2,
    .letter-detail-content h3 {
      font-family: 'Ma Shan Zheng', cursive;
      color: var(--color-brand-deep);
      margin: 0 24px;
    }

    .letter-detail-content p {
      margin: 0 16px;
    }

    .letter-detail-content blockquote {
      margin: 0 24px;
      padding: 0 16px;
      border-right: 3px solid var(--color-brand);
      color: var(--color-muted);
    }

    .letter-nav {
      display: flex;
      justify-content: space-between;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid rgba(92, 64, 51, 0.2);
    }

    .letter-nav-btn {
      padding: 10px 20px;
      background: var(--color-brand);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      transition: all var(--transition-fast);
    }

    .letter-nav-btn:hover {
      background: var(--color-brand-deep);
    }

    .letter-nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* ==================== Module: 百宝阁 (Cards) ==================== */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .card-wrapper {
      perspective: 1000px;
      height: 360px;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s;
      transform-style: preserve-3d;
      cursor: pointer;
    }

    .card-wrapper.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 16px;
      box-shadow: var(--shadow-card);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 32px;
    }

    .card-front {
      background: linear-gradient(135deg, var(--color-paper) 0%, #f8f5ed 100%);
      border: 3px solid;
    }

    .card-front.style-bamboo {
      border-color: var(--color-bamboo);
      background-image:
        linear-gradient(135deg, var(--color-paper) 0%, #e8f5e9 100%);
    }

    .card-front.style-red {
      border-color: var(--color-red);
      background-image:
        linear-gradient(135deg, var(--color-paper) 0%, #ffebee 100%);
    }

    .card-front.style-moon {
      border-color: #d4a574;
      background-image:
        linear-gradient(135deg, var(--color-moon) 0%, #fff8e1 100%);
    }

    .card-back {
      background: var(--color-paper);
      transform: rotateY(180deg);
      padding: 40px 32px;
    }

    .card-front-title {
      font-family: 'Ma Shan Zheng', cursive;
      font-size: 2rem;
      margin-bottom: 16px;
      text-align: center;
    }

    .card-front.style-bamboo .card-front-title {
      color: var(--color-bamboo);
    }

    .card-front.style-red .card-front-title {
      color: var(--color-red);
    }

    .card-front.style-moon .card-front-title {
      color: #d4a574;
    }

    .card-festival {
      font-size: 1rem;
      color: var(--color-muted);
    }

    .card-back-content {
      font-size: 1.2rem;
      line-height: 2;
      color: var(--color-ink);
      text-align: center;
      white-space: pre-line;
    }

    /* ==================== Utilities ==================== */
    .hidden {
      display: none !important;
    }

    /* ==================== Responsive ==================== */
    @media (max-width: 768px) {
      .gate-card {
        padding: 32px 24px;
      }

      .gate-title {
        font-size: 2rem;
      }

      .nav-bar {
        padding: 12px 16px;
      }

      .nav-item {
        padding: 10px 16px;
        font-size: 1rem;
      }

      .message-card {
        padding: 32px 24px;
      }

      .message-content {
        font-size: 1.4rem;
        min-height: 100px;
      }

      .letter-detail {
        padding: 32px 24px;
      }

      .letter-detail-content {
        font-size: 1.1rem;
        writing-mode: horizontal-tb;
        text-orientation: mixed;
        direction: ltr;
      }

      .cards-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- ==================== Password Gate ==================== -->
  <div id="password-gate">
    <div class="gate-card">
      <h1 class="gate-title">請啟封</h1>
      <p class="gate-subtitle">此間私語，待君親啟</p>
      <div class="gate-input-group">
        <input type="password" id="password-input" class="gate-input"
               placeholder="心有靈犀" autocomplete="off">
        <button id="password-submit" class="gate-button">開啟</button>
      </div>
      <p id="password-error" class="gate-error">密語有誤，請再思之</p>
    </div>
  </div>

  <!-- ==================== Main Application ==================== -->
  <div id="main-app">
    <div class="app-container">
      <!-- Navigation Bar -->
      <nav class="nav-bar">
        <button class="nav-item active" data-tab="messages">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          </svg>
          轩窗
        </button>
        <button class="nav-item" data-tab="letters">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          锦书
        </button>
        <button class="nav-item" data-tab="cards">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
            <path d="M16 3h2v4M8 3H6v4"></path>
          </svg>
          百寶閣
        </button>
      </nav>

      <!-- Content Area -->
      <div class="content-area">
        <!-- 轩窗 Panel -->
        <div id="panel-messages" class="content-panel active">
          <div class="message-card">
            <div id="message-content" class="message-content">
              載入中...
            </div>
            <div class="message-meta">
              <div>
                <div id="message-author"></div>
              </div>
              <div id="message-date"></div>
            </div>
            <button id="message-refresh" class="message-refresh">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
              </svg>
              換一句
            </button>
          </div>
        </div>

        <!-- 锦书 Panel -->
        <div id="panel-letters" class="content-panel">
          <div class="letters-container">
            <div id="letters-list-view" class="letters-list">
              <!-- Letters will be loaded here -->
            </div>
            <div id="letter-detail-view" class="letter-detail hidden">
              <div class="letter-detail-header">
                <h2 id="letter-detail-title" class="letter-detail-title"></h2>
                <p id="letter-detail-date" class="letter-detail-date"></p>
              </div>
              <div id="letter-detail-content" class="letter-detail-content">
                <!-- Letter content will be rendered here -->
              </div>
              <div class="letter-nav">
                <button id="letter-prev" class="letter-nav-btn">上一封</button>
                <button id="letter-back" class="letter-nav-btn">返回列表</button>
                <button id="letter-next" class="letter-nav-btn">下一封</button>
              </div>
            </div>
          </div>
        </div>

        <!-- 百宝阁 Panel -->
        <div id="panel-cards" class="content-panel">
          <div id="cards-grid" class="cards-grid">
            <!-- Cards will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== JavaScript ==================== -->
  <script>
    // ==================== State Management ====================
    const state = {
      messages: [],
      letters: [],
      cards: [],
      currentMessage: null,
      currentLetterIndex: -1,
      activeTab: 'messages'
    };

    // ==================== Password Gate ====================
    const passwordGate = {
      init() {
        const input = document.getElementById('password-input');
        const submit = document.getElementById('password-submit');
        const error = document.getElementById('password-error');
        const gate = document.getElementById('password-gate');
        const mainApp = document.getElementById('main-app');

        // Check session storage
        if (sessionStorage.getItem('authenticated') === 'true') {
          this.unlock();
          return;
        }

        const checkPassword = () => {
          const value = input.value.trim();
          if (value === '0214') {
            sessionStorage.setItem('authenticated', 'true');
            this.unlock();
          } else {
            error.classList.add('show');
            input.value = '';
            input.animate([
              { transform: 'translateX(-8px)' },
              { transform: 'translateX(8px)' },
              { transform: 'translateX(-8px)' },
              { transform: 'translateX(8px)' },
              { transform: 'translateX(0)' }
            ], { duration: 400, easing: 'ease-in-out' });
            setTimeout(() => error.classList.remove('show'), 3000);
          }
        };

        submit.addEventListener('click', checkPassword);
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') checkPassword();
        });
      },

      unlock() {
        const gate = document.getElementById('password-gate');
        const mainApp = document.getElementById('main-app');

        gate.classList.add('hidden');
        mainApp.classList.add('show');

        // Initialize app after unlocking
        app.init();
      }
    };

    // ==================== Data Loading ====================
    const dataLoader = {
      async loadMessages() {
        try {
          const response = await fetch('data/messages.json');
          state.messages = await response.json();
        } catch (error) {
          console.error('Failed to load messages:', error);
          state.messages = [];
        }
      },

      async loadLetters() {
        try {
          const response = await fetch('data/letters_index.json');
          state.letters = await response.json();
          state.letters.sort((a, b) => new Date(b.date) - new Date(a.date));
        } catch (error) {
          console.error('Failed to load letters:', error);
          state.letters = [];
        }
      },

      async loadCards() {
        try {
          const response = await fetch('data/cards.json');
          state.cards = await response.json();
        } catch (error) {
          console.error('Failed to load cards:', error);
          state.cards = [];
        }
      },

      async loadAll() {
        await Promise.all([
          this.loadMessages(),
          this.loadLetters(),
          this.loadCards()
        ]);
      }
    };

    // ==================== Messages Module ====================
    const messagesModule = {
      init() {
        this.showRandomMessage();
        document.getElementById('message-refresh').addEventListener('click', () => {
          this.showRandomMessage();
        });
      },

      showRandomMessage() {
        if (state.messages.length === 0) return;

        const randomIndex = Math.floor(Math.random() * state.messages.length);
        const message = state.messages[randomIndex];
        state.currentMessage = message;

        document.getElementById('message-content').textContent = message.content;
        document.getElementById('message-author').textContent = message.author;
        document.getElementById('message-date').textContent = message.date;
      }
    };

    // ==================== Letters Module ====================
    const lettersModule = {
      init() {
        this.renderList();
      },

      renderList() {
        const listView = document.getElementById('letters-list-view');
        listView.innerHTML = '';

        if (state.letters.length === 0) {
          listView.innerHTML = '<p style="text-align: center; color: var(--color-muted);">暫無信件</p>';
          return;
        }

        state.letters.forEach((letter, index) => {
          const item = document.createElement('div');
          item.className = 'letter-item';
          item.innerHTML = `
            <h3 class="letter-title">${letter.title}</h3>
            <p class="letter-date">${letter.date}</p>
            <p class="letter-preview">${letter.preview}</p>
          `;
          item.addEventListener('click', () => this.showDetail(index));
          listView.appendChild(item);
        });
      },

      async showDetail(index) {
        state.currentLetterIndex = index;
        const letter = state.letters[index];

        // Fetch letter content
        try {
          const response = await fetch(letter.file);
          const markdown = await response.text();
          // Use marked function (compatible with v4.x)
          const html = typeof marked !== 'undefined'
            ? (marked.parse ? marked.parse(markdown) : marked(markdown))
            : markdown.replace(/\n/g, '<br>');

          document.getElementById('letter-detail-title').textContent = letter.title;
          document.getElementById('letter-detail-date').textContent = letter.date;
          document.getElementById('letter-detail-content').innerHTML = html;

          // Update navigation buttons
          document.getElementById('letter-prev').disabled = index === state.letters.length - 1;
          document.getElementById('letter-next').disabled = index === 0;

          // Show detail view
          document.getElementById('letters-list-view').classList.add('hidden');
          document.getElementById('letter-detail-view').classList.remove('hidden');
        } catch (error) {
          console.error('Failed to load letter:', error);
          alert('無法載入信件內容');
        }
      },

      hideDetail() {
        document.getElementById('letters-list-view').classList.remove('hidden');
        document.getElementById('letter-detail-view').classList.add('hidden');
        state.currentLetterIndex = -1;
      },

      setupNavigation() {
        document.getElementById('letter-back').addEventListener('click', () => {
          this.hideDetail();
        });

        document.getElementById('letter-prev').addEventListener('click', () => {
          if (state.currentLetterIndex < state.letters.length - 1) {
            this.showDetail(state.currentLetterIndex + 1);
          }
        });

        document.getElementById('letter-next').addEventListener('click', () => {
          if (state.currentLetterIndex > 0) {
            this.showDetail(state.currentLetterIndex - 1);
          }
        });
      }
    };

    // ==================== Cards Module ====================
    const cardsModule = {
      init() {
        this.renderCards();
      },

      renderCards() {
        const grid = document.getElementById('cards-grid');
        grid.innerHTML = '';

        if (state.cards.length === 0) {
          grid.innerHTML = '<p style="text-align: center; color: var(--color-muted); grid-column: 1/-1;">暫無賀卡</p>';
          return;
        }

        state.cards.forEach(card => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          wrapper.innerHTML = `
            <div class="card-inner">
              <div class="card-face card-front style-${card.style}">
                <h3 class="card-front-title">${card.title}</h3>
                <p class="card-festival">${card.festival}</p>
              </div>
              <div class="card-face card-back">
                <div class="card-back-content">${card.content}</div>
              </div>
            </div>
          `;

          wrapper.addEventListener('click', () => {
            wrapper.classList.toggle('flipped');
          });

          grid.appendChild(wrapper);
        });
      }
    };

    // ==================== Tab Navigation ====================
    const tabNavigation = {
      init() {
        const navItems = document.querySelectorAll('.nav-item');

        navItems.forEach(item => {
          item.addEventListener('click', () => {
            const tab = item.dataset.tab;
            this.switchTab(tab);
          });
        });
      },

      switchTab(tabName) {
        // Update nav items
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.toggle('active', item.dataset.tab === tabName);
        });

        // Update content panels
        document.querySelectorAll('.content-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        document.getElementById(`panel-${tabName}`).classList.add('active');

        state.activeTab = tabName;

        // Hide letter detail if switching away from letters
        if (tabName !== 'letters') {
          lettersModule.hideDetail();
        }
      }
    };

    // ==================== Main App ====================
    const app = {
      async init() {
        await dataLoader.loadAll();

        messagesModule.init();
        lettersModule.init();
        lettersModule.setupNavigation();
        cardsModule.init();
        tabNavigation.init();
      }
    };

    // ==================== Initialize ====================
    document.addEventListener('DOMContentLoaded', () => {
      // Check if marked.js is loaded
      if (typeof marked === 'undefined') {
        console.warn('marked.js not loaded, letter content will display as plain text');
      } else {
        console.log('marked.js loaded successfully');
      }

      passwordGate.init();
    });
  </script>
</body>
</html>
