<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…æ™å°ç«™ Â· æ¡ƒææ˜¥é¢¨</title>
  <meta name="description" content="æ¸…æ™å°ç«™ - ä¸€è™•å¤é¢¨é›…è‡´çš„äº’å‹•ç«™é»ï¼Œå¯„èªå¿ƒèªï¼ŒéŒ¦æ›¸é•·ä¿¡ï¼Œç¯€æ—¥è³€å¡ã€‚">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+TC:wght@400;500;700&family=ZCOOL+XiaoWei&family=Long+Cang&display=swap" rel="stylesheet">

  <!-- Marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>

  <style>
    /* ==================== CSS Variables ==================== */
    :root {
      --color-ink: #3a2d22;
      --color-ink-light: #5c4033;
      --color-muted: #6e6258;
      --color-paper: #fffef9;
      --color-paper-alpha: rgba(255, 254, 249, 0.92);
      --color-brand: #8c6b5d;
      --color-brand-deep: #5c4033;
      --color-red: #c8372d;
      --color-bamboo: #5a8776;
      --color-moon: #f5e6d3;
      --shadow-soft: 0 8px 24px rgba(0, 0, 0, 0.08);
      --shadow-card: 0 4px 12px rgba(0, 0, 0, 0.12);
      --transition-fast: 0.3s ease;
      --transition-normal: 0.5s ease;
    }

    /* ==================== Reset & Base ==================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Noto Serif TC', serif;
      color: var(--color-ink);
      background: linear-gradient(135deg, #f4f1ea 0%, #e8dfd0 100%);
      background-attachment: fixed;
      min-height: 100vh;
      line-height: 1.8;
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* ==================== Password Gate ==================== */
    #password-gate {
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #f4f1ea 0%, #e8dfd0 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.8s ease;
    }

    #password-gate.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .gate-card {
      background: var(--color-paper-alpha);
      padding: 48px 40px;
      border-radius: 16px;
      box-shadow: var(--shadow-soft);
      text-align: center;
      max-width: 420px;
      width: 90%;
      backdrop-filter: blur(10px);
    }

    .gate-title {
      font-family: 'Ma Shan Zheng', cursive;
      font-size: 2.4rem;
      color: var(--color-brand-deep);
      margin-bottom: 16px;
    }

    .gate-subtitle {
      color: var(--color-muted);
      font-size: 1rem;
      margin-bottom: 32px;
    }

    .gate-input-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .gate-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid #d4c4b0;
      border-radius: 8px;
      font-size: 1rem;
      font-family: inherit;
      outline: none;
      transition: border-color var(--transition-fast);
    }

    .gate-input:focus {
      border-color: var(--color-brand);
      box-shadow: 0 0 0 4px rgba(140, 107, 93, 0.1);
    }

    .gate-button {
      padding: 12px 24px;
      background: linear-gradient(135deg, var(--color-brand), var(--color-brand-deep));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: transform var(--transition-fast), box-shadow var(--transition-fast);
      font-family: inherit;
    }

    .gate-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(92, 64, 51, 0.3);
    }

    .gate-button:active {
      transform: translateY(0);
    }

    .gate-error {
      color: var(--color-red);
      font-size: 0.9rem;
      margin-top: 12px;
      opacity: 0;
      transition: opacity var(--transition-fast);
    }

    .gate-error.show {
      opacity: 1;
    }

    /* ==================== Main Layout ==================== */
    #main-app {
      opacity: 0;
      transition: opacity 0.8s ease;
    }

    #main-app.show {
      opacity: 1;
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* ==================== Navigation Bar ==================== */
    .nav-bar {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 16px 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-soft);
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .nav-item {
      padding: 12px 24px;
      background: transparent;
      border: 2px solid transparent;
      border-radius: 12px;
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--color-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Ma Shan Zheng', cursive;
    }

    .nav-item:hover {
      color: var(--color-brand-deep);
      background: rgba(140, 107, 93, 0.1);
    }

    .nav-item.active {
      color: var(--color-brand-deep);
      border-color: var(--color-brand);
      background: rgba(140, 107, 93, 0.15);
    }

    .nav-icon {
      width: 20px;
      height: 20px;
    }

    /* ==================== Content Area ==================== */
    .content-area {
      position: relative;
      min-height: 500px;
    }

    .content-panel {
      position: absolute;
      width: 100%;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--transition-normal);
    }

    .content-panel.active {
      opacity: 1;
      pointer-events: auto;
    }

    /* ==================== Module: è½©çª— (Messages) ==================== */
    .message-card {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 48px 40px;
      box-shadow: var(--shadow-soft);
      text-align: center;
      max-width: 700px;
      margin: 0 auto;
      position: relative;
    }

    .message-content {
      font-size: 1.8rem;
      line-height: 2.2;
      color: var(--color-ink);
      margin-bottom: 32px;
      font-weight: 500;
      min-height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .message-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--color-muted);
      font-size: 1rem;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid rgba(92, 64, 51, 0.2);
    }

    .message-refresh {
      padding: 10px 20px;
      background: var(--color-brand);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.95rem;
      font-family: inherit;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 24px auto 0;
    }

    .message-refresh:hover {
      background: var(--color-brand-deep);
      transform: translateY(-2px);
    }

    /* ==================== Module: é”¦ä¹¦ (Letters) ==================== */
    .letters-container {
      max-width: 900px;
      margin: 0 auto;
    }

    .letters-list {
      display: grid;
      gap: 16px;
    }

    .letter-item {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 24px;
      box-shadow: var(--shadow-card);
      cursor: pointer;
      transition: all var(--transition-fast);
      border: 2px solid transparent;
    }

    .letter-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      border-color: var(--color-brand);
    }

    .letter-title {
      font-size: 1.4rem;
      color: var(--color-brand-deep);
      margin-bottom: 8px;
      font-family: 'Ma Shan Zheng', cursive;
    }

    .letter-date {
      color: var(--color-muted);
      font-size: 0.9rem;
      margin-bottom: 12px;
    }

    .letter-preview {
      color: var(--color-ink-light);
      font-size: 1rem;
      line-height: 1.6;
    }

    /* Letter Detail View */
    .letter-detail {
      background: var(--color-paper-alpha);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 40px 32px;
      box-shadow: var(--shadow-soft);
      max-width: 95%;
      width: 100%;
      margin: 0 auto;
      position: relative;
      border: 1px solid rgba(140, 107, 93, 0.2);
      overflow: hidden;
    }

    /* æ¨¡æ‹Ÿå¤ç±è£…è®¢çº¿ï¼ˆå³ä¾§ï¼‰*/
    .letter-detail::before {
      content: '';
      position: absolute;
      top: 0;
      right: 16px;
      bottom: 0;
      width: 2px;
      background: repeating-linear-gradient(
        to bottom,
        transparent,
        transparent 20px,
        rgba(140, 107, 93, 0.3) 20px,
        rgba(140, 107, 93, 0.3) 22px
      );
      pointer-events: none;
      z-index: 1;
    }

    .letter-detail-content {
      /* ç«–æ’ç‰ˆï¼šä»å³åˆ°å·¦ï¼Œä»ä¸Šåˆ°ä¸‹ */
      writing-mode: vertical-rl;
      /* æ–‡å­—æ–¹å‘ï¼šå…¨éƒ¨ç«–å‘æ˜¾ç¤º */
      text-orientation: upright;
      /* å­—é—´è·ï¼ˆå‚ç›´æ–¹å‘ï¼‰*/
      line-height: 2.5;
      /* å­—ç¬¦é—´è· */
      letter-spacing: 0.08em;
      font-size: 1.15rem;
      color: var(--color-ink);
      /* å›ºå®šé«˜åº¦ï¼Œé˜²æ­¢è¶Šç•Œ */
      height: 65vh;
      min-height: 400px;
      max-height: 700px;
      /* å…³é”®ï¼šå…è®¸å†…å®¹å®½åº¦è‡ªé€‚åº” */
      width: 100%;
      padding: 24px 48px 24px 24px;
      /* æ°´å¹³æ»šåŠ¨æŸ¥çœ‹æ›´å¤šå†…å®¹ */
      overflow-x: auto;
      overflow-y: hidden;
      /* ä¼˜åŒ–æ–‡å­—æ¸²æŸ“ */
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
      /* ç¡®ä¿ä»å³ä¾§å¼€å§‹ */
      text-align: start;
      /* ç¡®ä¿æ»šåŠ¨æ¡å¯è§ */
      scrollbar-width: thin;
    }

    /* ç«–æ’ç‰ˆæ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
    .letter-detail-content::-webkit-scrollbar {
      height: 8px;
    }

    .letter-detail-content::-webkit-scrollbar-track {
      background: rgba(140, 107, 93, 0.08);
      border-radius: 4px;
    }

    .letter-detail-content::-webkit-scrollbar-thumb {
      background: var(--color-brand);
      border-radius: 4px;
    }

    .letter-detail-content::-webkit-scrollbar-thumb:hover {
      background: var(--color-brand-deep);
    }

    /* ä¿¡ä»¶æ ‡é¢˜æ ·å¼ï¼ˆæœ€å³ä¾§ï¼‰*/
    .letter-detail-content .letter-title-text {
      font-family: 'Ma Shan Zheng', cursive;
      font-size: 1.8rem;
      color: var(--color-brand-deep);
      font-weight: 700;
      letter-spacing: 0.25em;
      line-height: 2;
      margin: 0 60px 0 0;
      display: inline-block;
    }

    /* æ—¥æœŸæ ·å¼ */
    .letter-detail-content .letter-date-text {
      font-size: 1rem;
      color: var(--color-muted);
      letter-spacing: 0.15em;
      margin: 0 48px 0 0;
      display: inline-block;
    }

    /* åˆ†éš”çº¿ï¼ˆç«–çº¿ï¼‰*/
    .letter-detail-content .letter-separator {
      display: inline-block;
      width: 0;
      height: 100%;
      border-right: 2px solid rgba(92, 64, 51, 0.3);
      margin: 0 40px 0 0;
    }

    .letter-detail-content h1,
    .letter-detail-content h2,
    .letter-detail-content h3 {
      font-family: 'Ma Shan Zheng', cursive;
      color: var(--color-brand-deep);
      margin: 0 36px 0 0;
      font-weight: 700;
      letter-spacing: 0.18em;
      line-height: 2.2;
      display: inline-block;
    }

    .letter-detail-content h1 {
      font-size: 1.4rem;
    }

    .letter-detail-content h2 {
      font-size: 1.25rem;
    }

    .letter-detail-content h3 {
      font-size: 1.15rem;
    }

    .letter-detail-content p {
      margin: 0 24px 0 0;
      text-indent: 0;
      line-height: 2.5;
      display: inline-block;
    }

    /* è¿ç»­æ®µè½é—´è· */
    .letter-detail-content p + p {
      margin-right: 28px;
    }

    .letter-detail-content blockquote {
      margin: 0 32px 0 0;
      padding: 12px 16px 12px 0;
      border-right: 3px solid var(--color-brand);
      color: var(--color-muted);
      background: rgba(140, 107, 93, 0.06);
      line-height: 2.3;
      display: inline-block;
    }

    .letter-detail-content blockquote p {
      margin: 0;
    }

    /* å¼ºè°ƒæ–‡æœ¬ */
    .letter-detail-content strong,
    .letter-detail-content em {
      color: var(--color-brand-deep);
      font-weight: 600;
    }

    /* åˆ†éš”çº¿ */
    .letter-detail-content hr {
      display: inline-block;
      border: none;
      border-right: 1px solid rgba(92, 64, 51, 0.3);
      margin: 0 28px;
      height: 80%;
      width: 0;
    }

    .letter-nav {
      display: flex;
      justify-content: space-between;
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid rgba(92, 64, 51, 0.2);
    }

    .letter-nav-btn {
      padding: 10px 20px;
      background: var(--color-brand);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      transition: all var(--transition-fast);
    }

    .letter-nav-btn:hover {
      background: var(--color-brand-deep);
    }

    .letter-nav-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    /* ==================== Module: ç™¾å®é˜ (Cards) ==================== */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .card-wrapper {
      perspective: 1500px;
      height: 400px;
      position: relative;
    }

    /* æ‚¬åœæ—¶è´ºå¡è½»å¾®ä¸Šæµ® */
    .card-wrapper:hover {
      transform: translateY(-8px);
      transition: transform 0.3s ease;
    }

    .card-inner {
      position: relative;
      width: 100%;
      height: 100%;
      transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      transform-style: preserve-3d;
      cursor: pointer;
    }

    .card-wrapper.flipped .card-inner {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      overflow: hidden;
    }

    .card-front {
      background: linear-gradient(135deg, var(--color-paper) 0%, #f8f5ed 100%);
      border: 3px solid;
      position: relative;
    }

    /* ç«¹é’é£æ ¼ - æ•™å¸ˆèŠ‚ */
    .card-front.style-bamboo {
      border-color: var(--color-bamboo);
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
    }

    .card-front.style-bamboo::before {
      content: 'ğŸ‹';
      position: absolute;
      font-size: 8rem;
      opacity: 0.15;
      top: -20px;
      right: -20px;
      animation: float 6s ease-in-out infinite;
    }

    /* æœ±çº¢é£æ ¼ - æ˜¥èŠ‚ */
    .card-front.style-red {
      border-color: var(--color-red);
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
    }

    .card-front.style-red::before {
      content: 'ğŸ§§';
      position: absolute;
      font-size: 8rem;
      opacity: 0.2;
      bottom: -20px;
      left: -20px;
      animation: rotate 10s linear infinite;
    }

    /* æœˆç™½é£æ ¼ - ä¸­ç§‹ */
    .card-front.style-moon {
      border-color: #d4a574;
      background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    }

    .card-front.style-moon::before {
      content: 'ğŸŒ•';
      position: absolute;
      font-size: 8rem;
      opacity: 0.2;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: glow 3s ease-in-out infinite alternate;
    }

    /* åœ£è¯é£æ ¼ */
    .card-front.style-christmas {
      border-color: #2e7d32;
      background: linear-gradient(135deg, #1b5e20 0%, #4caf50 100%);
      position: relative;
      overflow: visible;
    }

    .card-front.style-christmas::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 2px, transparent 2px),
        radial-gradient(circle at 60% 70%, rgba(255, 255, 255, 0.3) 3px, transparent 3px),
        radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.3) 2px, transparent 2px),
        radial-gradient(circle at 40% 90%, rgba(255, 255, 255, 0.3) 3px, transparent 3px);
      background-size: 100% 100%;
      animation: snowfall 15s linear infinite;
      pointer-events: none;
    }

    /* å…ƒæ—¦é£æ ¼ */
    .card-front.style-newyear {
      border-color: #ff6f00;
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
      position: relative;
    }

    .card-front.style-newyear::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background:
        radial-gradient(circle at 30% 40%, rgba(255, 215, 0, 0.6) 4px, transparent 4px),
        radial-gradient(circle at 70% 60%, rgba(255, 107, 107, 0.6) 6px, transparent 6px),
        radial-gradient(circle at 50% 20%, rgba(66, 165, 245, 0.6) 5px, transparent 5px);
      background-size: 200% 200%;
      animation: fireworks 4s ease-in-out infinite;
      pointer-events: none;
    }

    .card-back {
      background: var(--color-paper);
      transform: rotateY(180deg);
      padding: 40px 32px;
    }

    .card-front-title {
      font-family: 'Ma Shan Zheng', cursive;
      font-size: 2rem;
      margin-bottom: 16px;
      text-align: center;
    }

    .card-front.style-bamboo .card-front-title {
      color: var(--color-bamboo);
    }

    .card-front.style-red .card-front-title {
      color: var(--color-red);
    }

    .card-front.style-moon .card-front-title {
      color: #d4a574;
    }

    .card-front.style-christmas .card-front-title {
      color: #ffffff;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .card-front.style-newyear .card-front-title {
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .card-festival {
      font-size: 1rem;
      color: var(--color-muted);
    }

    .card-front.style-christmas .card-festival,
    .card-front.style-newyear .card-festival {
      color: rgba(255, 255, 255, 0.9);
    }

    .card-back-content {
      font-size: 1.2rem;
      line-height: 2;
      color: var(--color-ink);
      text-align: center;
      white-space: pre-line;
    }

    /* ==================== Animations ==================== */
    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-20px);
      }
    }

    @keyframes rotate {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes glow {
      0% {
        opacity: 0.2;
        filter: brightness(1);
      }
      100% {
        opacity: 0.4;
        filter: brightness(1.3);
      }
    }

    @keyframes snowfall {
      0% {
        background-position: 0 0, 0 0, 0 0, 0 0;
      }
      100% {
        background-position: 500px 1000px, -400px 800px, 600px 1200px, -300px 900px;
      }
    }

    @keyframes fireworks {
      0%, 100% {
        opacity: 0.6;
        transform: scale(1);
      }
      50% {
        opacity: 1;
        transform: scale(1.2);
      }
    }

    /* ==================== Card Modal ==================== */
    .card-modal {
      position: fixed;
      inset: 0;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }

    .card-modal:not(.hidden) {
      opacity: 1;
      pointer-events: auto;
    }

    .card-modal-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      animation: fadeIn 0.4s ease;
    }

    .card-modal-container {
      position: relative;
      width: 90%;
      max-width: 600px;
      max-height: 85vh;
      background: var(--color-paper);
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      animation: modalSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 1;
    }

    .card-modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border: none;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 24px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: all 0.3s ease;
      font-family: Arial, sans-serif;
    }

    .card-modal-close:hover {
      background: rgba(0, 0, 0, 0.8);
      transform: rotate(90deg);
    }

    .card-modal-content {
      position: relative;
      min-height: 400px;
      display: flex;
      flex-direction: column;
    }

    .card-modal-animation {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .card-modal-body {
      position: relative;
      padding: 60px 50px;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .card-modal-title {
      font-family: 'Long Cang', 'Ma Shan Zheng', cursive;
      font-size: 3rem;
      margin-bottom: 16px;
      background: linear-gradient(135deg, var(--color-brand-deep), var(--color-brand));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: titleFadeIn 0.8s ease 0.3s both;
    }

    .card-modal-festival {
      font-family: 'ZCOOL XiaoWei', 'Noto Serif TC', serif;
      font-size: 1.2rem;
      color: var(--color-muted);
      margin-bottom: 32px;
      animation: titleFadeIn 0.8s ease 0.4s both;
    }

    .card-modal-divider {
      width: 120px;
      height: 3px;
      background: linear-gradient(90deg, transparent, var(--color-brand), transparent);
      margin: 24px 0;
      animation: dividerExpand 0.6s ease 0.5s both;
    }

    .card-modal-message {
      font-family: 'ZCOOL XiaoWei', 'Noto Serif TC', serif;
      font-size: 1.4rem;
      line-height: 2.2;
      color: var(--color-ink);
      white-space: pre-line;
      animation: messageFadeIn 1s ease 0.6s both;
    }

    /* èŠ‚æ—¥ä¸»é¢˜æ ·å¼ */
    .card-modal.theme-bamboo .card-modal-container {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
    }

    .card-modal.theme-bamboo .card-modal-title {
      background: linear-gradient(135deg, #2e7d32, #4caf50);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .card-modal.theme-red .card-modal-container {
      background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
    }

    .card-modal.theme-red .card-modal-title {
      background: linear-gradient(135deg, #c62828, #e53935);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .card-modal.theme-moon .card-modal-container {
      background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
    }

    .card-modal.theme-moon .card-modal-title {
      background: linear-gradient(135deg, #d4a574, #f57c00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .card-modal.theme-christmas .card-modal-container {
      background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%);
    }

    .card-modal.theme-christmas .card-modal-title,
    .card-modal.theme-christmas .card-modal-festival,
    .card-modal.theme-christmas .card-modal-message {
      color: white;
      background: none;
      -webkit-text-fill-color: white;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
    }

    .card-modal.theme-newyear .card-modal-container {
      background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
    }

    .card-modal.theme-newyear .card-modal-title {
      color: #ffd700;
      background: none;
      -webkit-text-fill-color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
    }

    .card-modal.theme-newyear .card-modal-festival,
    .card-modal.theme-newyear .card-modal-message {
      color: white;
    }

    /* ModalåŠ¨ç”» */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: scale(0.8) translateY(40px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    @keyframes titleFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes dividerExpand {
      from {
        width: 0;
      }
      to {
        width: 120px;
      }
    }

    @keyframes messageFadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ==================== Utilities ==================== */
    .hidden {
      display: none !important;
    }

    /* ==================== Responsive ==================== */
    @media (max-width: 768px) {
      .gate-card {
        padding: 32px 24px;
      }

      .gate-title {
        font-size: 2rem;
      }

      .nav-bar {
        padding: 12px 16px;
      }

      .nav-item {
        padding: 10px 16px;
        font-size: 1rem;
      }

      .message-card {
        padding: 32px 24px;
      }

      .message-content {
        font-size: 1.4rem;
        min-height: 100px;
      }

      .letter-detail {
        padding: 24px 16px;
      }

      .letter-detail::before {
        display: none;
      }

      .letter-detail-content {
        font-size: 1.05rem;
        /* ç§»åŠ¨ç«¯åˆ‡æ¢ä¸ºæ¨ªæ’ç‰ˆ */
        writing-mode: horizontal-tb;
        text-orientation: mixed;
        direction: ltr;
        line-height: 1.9;
        letter-spacing: 0.05em;
        height: auto;
        max-height: none;
        overflow-x: visible;
        overflow-y: auto;
        padding: 16px 12px;
      }

      /* ç§»åŠ¨ç«¯æ ‡é¢˜æ ·å¼ */
      .letter-detail-content .letter-title-text {
        display: block;
        font-size: 1.6rem;
        text-align: center;
        margin: 0 0 12px 0;
        letter-spacing: 0.15em;
      }

      .letter-detail-content .letter-date-text {
        display: block;
        text-align: center;
        margin: 0 0 20px 0;
        font-size: 0.9rem;
      }

      .letter-detail-content .letter-separator {
        display: block;
        width: 60%;
        height: 0;
        border-right: none;
        border-bottom: 1px solid rgba(92, 64, 51, 0.3);
        margin: 0 auto 24px auto;
      }

      /* ç§»åŠ¨ç«¯æ®µè½æ ·å¼ */
      .letter-detail-content p {
        display: block;
        margin: 0 0 1em 0;
        text-indent: 2em;
      }

      .letter-detail-content p + p {
        margin-right: 0;
      }

      .letter-detail-content h1,
      .letter-detail-content h2,
      .letter-detail-content h3 {
        display: block;
        margin: 1.5em 0 0.8em 0;
        text-align: left;
      }

      .letter-detail-content blockquote {
        display: block;
        margin: 1em 0;
        padding: 0 0 0 16px;
        border-right: none;
        border-left: 2px solid var(--color-brand);
      }

      .letter-detail-content hr {
        display: block;
        border: none;
        border-top: 1px solid rgba(92, 64, 51, 0.3);
        margin: 1.5em 0;
        width: 100%;
        height: 0;
      }

      .cards-grid {
        grid-template-columns: 1fr;
        gap: 32px;
      }

      .card-wrapper {
        height: 360px;
      }
    }
  </style>
</head>
<body>
  <!-- ==================== Password Gate ==================== -->
  <div id="password-gate">
    <div class="gate-card">
      <h1 class="gate-title">è«‹å•Ÿå°</h1>
      <p class="gate-subtitle">æ­¤é–“ç§èªï¼Œå¾…å›è¦ªå•Ÿ</p>
      <div class="gate-input-group">
        <input type="password" id="password-input" class="gate-input"
               placeholder="å¿ƒæœ‰éˆçŠ€" autocomplete="off">
        <button id="password-submit" class="gate-button">é–‹å•Ÿ</button>
      </div>
      <p id="password-error" class="gate-error">å¯†èªæœ‰èª¤ï¼Œè«‹å†æ€ä¹‹</p>
    </div>
  </div>

  <!-- ==================== Main Application ==================== -->
  <div id="main-app">
    <div class="app-container">
      <!-- Navigation Bar -->
      <nav class="nav-bar">
        <button class="nav-item active" data-tab="messages">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          </svg>
          è½©çª—
        </button>
        <button class="nav-item" data-tab="letters">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          é”¦ä¹¦
        </button>
        <button class="nav-item" data-tab="cards">
          <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
            <path d="M16 3h2v4M8 3H6v4"></path>
          </svg>
          ç™¾å¯¶é–£
        </button>
      </nav>

      <!-- Content Area -->
      <div class="content-area">
        <!-- è½©çª— Panel -->
        <div id="panel-messages" class="content-panel active">
          <div class="message-card">
            <div id="message-content" class="message-content">
              è¼‰å…¥ä¸­...
            </div>
            <div class="message-meta">
              <div>
                <div id="message-author"></div>
              </div>
              <div id="message-date"></div>
            </div>
            <button id="message-refresh" class="message-refresh">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
              </svg>
              æ›ä¸€å¥
            </button>
          </div>
        </div>

        <!-- é”¦ä¹¦ Panel -->
        <div id="panel-letters" class="content-panel">
          <div class="letters-container">
            <div id="letters-list-view" class="letters-list">
              <!-- Letters will be loaded here -->
            </div>
            <div id="letter-detail-view" class="letter-detail hidden">
              <div id="letter-detail-content" class="letter-detail-content">
                <!-- Letter content will be rendered here (including title and date) -->
              </div>
              <div class="letter-nav">
                <button id="letter-prev" class="letter-nav-btn">ä¸Šä¸€å°</button>
                <button id="letter-back" class="letter-nav-btn">è¿”å›åˆ—è¡¨</button>
                <button id="letter-next" class="letter-nav-btn">ä¸‹ä¸€å°</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ç™¾å®é˜ Panel -->
        <div id="panel-cards" class="content-panel">
          <div id="cards-grid" class="cards-grid">
            <!-- Cards will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== Card Modal ==================== -->
  <div id="card-modal" class="card-modal hidden">
    <div class="card-modal-overlay"></div>
    <div class="card-modal-container">
      <button class="card-modal-close" aria-label="å…³é—­">âœ•</button>
      <div class="card-modal-content">
        <!-- SVGåŠ¨ç”»å®¹å™¨ -->
        <div class="card-modal-animation"></div>
        <!-- è´ºå¡å†…å®¹ -->
        <div class="card-modal-body">
          <h2 class="card-modal-title"></h2>
          <p class="card-modal-festival"></p>
          <div class="card-modal-divider"></div>
          <div class="card-modal-message"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== JavaScript ==================== -->
  <script>
    // ==================== State Management ====================
    const state = {
      messages: [],
      letters: [],
      cards: [],
      currentMessage: null,
      currentLetterIndex: -1,
      activeTab: 'messages'
    };

    // ==================== Password Gate ====================
    const passwordGate = {
      init() {
        const input = document.getElementById('password-input');
        const submit = document.getElementById('password-submit');
        const error = document.getElementById('password-error');
        const gate = document.getElementById('password-gate');
        const mainApp = document.getElementById('main-app');

        // Check session storage
        if (sessionStorage.getItem('authenticated') === 'true') {
          this.unlock();
          return;
        }

        const checkPassword = () => {
          const value = input.value.trim();
          if (value === '0214') {
            sessionStorage.setItem('authenticated', 'true');
            this.unlock();
          } else {
            error.classList.add('show');
            input.value = '';
            input.animate([
              { transform: 'translateX(-8px)' },
              { transform: 'translateX(8px)' },
              { transform: 'translateX(-8px)' },
              { transform: 'translateX(8px)' },
              { transform: 'translateX(0)' }
            ], { duration: 400, easing: 'ease-in-out' });
            setTimeout(() => error.classList.remove('show'), 3000);
          }
        };

        submit.addEventListener('click', checkPassword);
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') checkPassword();
        });
      },

      unlock() {
        const gate = document.getElementById('password-gate');
        const mainApp = document.getElementById('main-app');

        gate.classList.add('hidden');
        mainApp.classList.add('show');

        // Initialize app after unlocking
        app.init();
      }
    };

    // ==================== Data Loading ====================
    const dataLoader = {
      async loadMessages() {
        try {
          const response = await fetch('data/messages.json');
          state.messages = await response.json();
        } catch (error) {
          console.error('Failed to load messages:', error);
          state.messages = [];
        }
      },

      async loadLetters() {
        try {
          const response = await fetch('data/letters_index.json');
          state.letters = await response.json();
          state.letters.sort((a, b) => new Date(b.date) - new Date(a.date));
        } catch (error) {
          console.error('Failed to load letters:', error);
          state.letters = [];
        }
      },

      async loadCards() {
        try {
          const response = await fetch('data/cards.json');
          state.cards = await response.json();
        } catch (error) {
          console.error('Failed to load cards:', error);
          state.cards = [];
        }
      },

      async loadAll() {
        await Promise.all([
          this.loadMessages(),
          this.loadLetters(),
          this.loadCards()
        ]);
      }
    };

    // ==================== Messages Module ====================
    const messagesModule = {
      init() {
        this.showRandomMessage();
        document.getElementById('message-refresh').addEventListener('click', () => {
          this.showRandomMessage();
        });
      },

      showRandomMessage() {
        if (state.messages.length === 0) return;

        const randomIndex = Math.floor(Math.random() * state.messages.length);
        const message = state.messages[randomIndex];
        state.currentMessage = message;

        document.getElementById('message-content').textContent = message.content;
        document.getElementById('message-author').textContent = message.author;
        document.getElementById('message-date').textContent = message.date;
      }
    };

    // ==================== Letters Module ====================
    const lettersModule = {
      init() {
        this.renderList();
      },

      renderList() {
        const listView = document.getElementById('letters-list-view');
        listView.innerHTML = '';

        if (state.letters.length === 0) {
          listView.innerHTML = '<p style="text-align: center; color: var(--color-muted);">æš«ç„¡ä¿¡ä»¶</p>';
          return;
        }

        state.letters.forEach((letter, index) => {
          const item = document.createElement('div');
          item.className = 'letter-item';
          item.innerHTML = `
            <h3 class="letter-title">${letter.title}</h3>
            <p class="letter-date">${letter.date}</p>
            <p class="letter-preview">${letter.preview}</p>
          `;
          item.addEventListener('click', () => this.showDetail(index));
          listView.appendChild(item);
        });
      },

      async showDetail(index) {
        state.currentLetterIndex = index;
        const letter = state.letters[index];

        // Fetch letter content
        try {
          const response = await fetch(letter.file);
          let markdown = await response.text();

          // ç§»é™¤ Markdown ä¸­çš„ç¬¬ä¸€ä¸ª H1 æ ‡é¢˜ï¼ˆé¿å…é‡å¤ï¼‰
          markdown = markdown.replace(/^#\s+.*$/m, '');
          // ç§»é™¤å¼€å¤´çš„ç©ºè¡Œ
          markdown = markdown.trim();

          // Use marked function (compatible with v4.x)
          const contentHtml = typeof marked !== 'undefined'
            ? (marked.parse ? marked.parse(markdown) : marked(markdown))
            : markdown.replace(/\n/g, '<br>');

          // æ„å»ºå®Œæ•´çš„ä¿¡ä»¶å†…å®¹ï¼ˆæ ‡é¢˜ + æ—¥æœŸ + åˆ†éš”çº¿ + æ­£æ–‡ï¼‰
          // æŒ‰ç…§ä¼ ç»Ÿä¹¦ä¿¡æ ¼å¼ï¼šä»å³åˆ°å·¦ä¾æ¬¡ä¸º æ ‡é¢˜ã€æ—¥æœŸã€åˆ†éš”çº¿ã€æ­£æ–‡
          const fullHtml = `
            <div class="letter-title-text">${letter.title}</div>
            <div class="letter-date-text">${letter.date}</div>
            <div class="letter-separator"></div>
            ${contentHtml}
          `;

          document.getElementById('letter-detail-content').innerHTML = fullHtml;

          // Update navigation buttons
          document.getElementById('letter-prev').disabled = index === state.letters.length - 1;
          document.getElementById('letter-next').disabled = index === 0;

          // Show detail view
          document.getElementById('letters-list-view').classList.add('hidden');
          document.getElementById('letter-detail-view').classList.remove('hidden');
        } catch (error) {
          console.error('Failed to load letter:', error);
          alert('ç„¡æ³•è¼‰å…¥ä¿¡ä»¶å…§å®¹');
        }
      },

      hideDetail() {
        document.getElementById('letters-list-view').classList.remove('hidden');
        document.getElementById('letter-detail-view').classList.add('hidden');
        state.currentLetterIndex = -1;
      },

      setupNavigation() {
        document.getElementById('letter-back').addEventListener('click', () => {
          this.hideDetail();
        });

        document.getElementById('letter-prev').addEventListener('click', () => {
          if (state.currentLetterIndex < state.letters.length - 1) {
            this.showDetail(state.currentLetterIndex + 1);
          }
        });

        document.getElementById('letter-next').addEventListener('click', () => {
          if (state.currentLetterIndex > 0) {
            this.showDetail(state.currentLetterIndex - 1);
          }
        });
      }
    };

    // ==================== Cards Module ====================
    const cardsModule = {
      init() {
        this.renderCards();
      },

      renderCards() {
        const grid = document.getElementById('cards-grid');
        grid.innerHTML = '';

        if (state.cards.length === 0) {
          grid.innerHTML = '<p style="text-align: center; color: var(--color-muted); grid-column: 1/-1;">æš«ç„¡è³€å¡</p>';
          return;
        }

        state.cards.forEach((card, index) => {
          const wrapper = document.createElement('div');
          wrapper.className = 'card-wrapper';
          wrapper.innerHTML = `
            <div class="card-inner">
              <div class="card-face card-front style-${card.style}">
                <h3 class="card-front-title">${card.title}</h3>
                <p class="card-festival">${card.festival}</p>
              </div>
              <div class="card-face card-back">
                <div class="card-back-content">${card.content}</div>
              </div>
            </div>
          `;

          // ç‚¹å‡»æ‰“å¼€æ¨¡æ€æ¡†
          wrapper.addEventListener('click', () => {
            cardModalModule.open(card);
          });

          grid.appendChild(wrapper);
        });
      }
    };

    // ==================== Card Modal Module ====================
    const cardModalModule = {
      modal: null,
      overlay: null,
      closeBtn: null,
      animationContainer: null,

      init() {
        this.modal = document.getElementById('card-modal');
        this.overlay = this.modal.querySelector('.card-modal-overlay');
        this.closeBtn = this.modal.querySelector('.card-modal-close');
        this.animationContainer = this.modal.querySelector('.card-modal-animation');

        // å…³é—­æŒ‰é’®äº‹ä»¶
        this.closeBtn.addEventListener('click', () => this.close());

        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        this.overlay.addEventListener('click', () => this.close());

        // ESCé”®å…³é—­
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && !this.modal.classList.contains('hidden')) {
            this.close();
          }
        });
      },

      open(card) {
        // è®¾ç½®å†…å®¹
        this.modal.querySelector('.card-modal-title').textContent = card.title;
        this.modal.querySelector('.card-modal-festival').textContent = card.festival;
        this.modal.querySelector('.card-modal-message').textContent = card.content;

        // è®¾ç½®ä¸»é¢˜
        this.modal.className = 'card-modal';
        this.modal.classList.add(`theme-${card.style}`);

        // æ·»åŠ SVGåŠ¨ç”»
        this.renderAnimation(card.style);

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        this.modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      },

      close() {
        this.modal.classList.add('hidden');
        document.body.style.overflow = '';
        // æ¸…ç©ºåŠ¨ç”»å®¹å™¨
        setTimeout(() => {
          this.animationContainer.innerHTML = '';
        }, 400);
      },

      renderAnimation(style) {
        this.animationContainer.innerHTML = '';

        switch (style) {
          case 'bamboo':
            this.animationContainer.innerHTML = this.getBambooSVG();
            break;
          case 'red':
            this.animationContainer.innerHTML = this.getRedEnvelopeSVG();
            break;
          case 'moon':
            this.animationContainer.innerHTML = this.getMoonSVG();
            break;
          case 'christmas':
            this.animationContainer.innerHTML = this.getChristmasSVG();
            break;
          case 'newyear':
            this.animationContainer.innerHTML = this.getNewYearSVG();
            break;
        }
      },

      // SVGåŠ¨ç”»æ¨¡æ¿
      getBambooSVG() {
        return `
          <svg viewBox="0 0 600 400" style="width: 100%; height: 100%;">
            <defs>
              <linearGradient id="bambooGrad" x1="0%" y1="0%" x2="0%" y1="100%">
                <stop offset="0%" style="stop-color:#4caf50;stop-opacity:0.8" />
                <stop offset="100%" style="stop-color:#2e7d32;stop-opacity:0.6" />
              </linearGradient>
            </defs>
            <g class="bamboo-group">
              <rect x="50" y="50" width="15" height="80" fill="url(#bambooGrad)" rx="7">
                <animate attributeName="height" values="80;90;80" dur="3s" repeatCount="indefinite"/>
              </rect>
              <rect x="50" y="140" width="15" height="80" fill="url(#bambooGrad)" rx="7">
                <animate attributeName="height" values="80;85;80" dur="3.5s" repeatCount="indefinite"/>
              </rect>
              <rect x="530" y="100" width="15" height="90" fill="url(#bambooGrad)" rx="7">
                <animate attributeName="height" values="90;100;90" dur="3.2s" repeatCount="indefinite"/>
              </rect>
            </g>
          </svg>
        `;
      },

      getRedEnvelopeSVG() {
        return `
          <svg viewBox="0 0 600 400" style="width: 100%; height: 100%;">
            <g class="envelope-group" opacity="0.3">
              <rect x="100" y="50" width="60" height="40" fill="#c62828" rx="3">
                <animateTransform attributeName="transform" type="rotate"
                  from="0 130 70" to="360 130 70" dur="20s" repeatCount="indefinite"/>
              </rect>
              <rect x="440" y="300" width="50" height="35" fill="#e53935" rx="3">
                <animateTransform attributeName="transform" type="rotate"
                  from="0 465 317.5" to="-360 465 317.5" dur="25s" repeatCount="indefinite"/>
              </rect>
            </g>
          </svg>
        `;
      },

      getMoonSVG() {
        return `
          <svg viewBox="0 0 600 400" style="width: 100%; height: 100%;">
            <defs>
              <radialGradient id="moonGrad">
                <stop offset="0%" style="stop-color:#fff8e1;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#ffecb3;stop-opacity:0.3" />
              </radialGradient>
            </defs>
            <circle cx="300" cy="200" r="80" fill="url(#moonGrad)" opacity="0.4">
              <animate attributeName="r" values="80;90;80" dur="4s" repeatCount="indefinite"/>
              <animate attributeName="opacity" values="0.4;0.6;0.4" dur="4s" repeatCount="indefinite"/>
            </circle>
          </svg>
        `;
      },

      getChristmasSVG() {
        const snowflakes = [];
        for (let i = 0; i < 30; i++) {
          const x = Math.random() * 600;
          const y = Math.random() * 400;
          const size = Math.random() * 3 + 2;
          const duration = Math.random() * 3 + 2;
          const delay = Math.random() * 2;

          snowflakes.push(`
            <circle cx="${x}" cy="${y}" r="${size}" fill="white" opacity="0.8">
              <animate attributeName="cy" from="-20" to="420"
                dur="${duration}s" begin="${delay}s" repeatCount="indefinite"/>
              <animate attributeName="opacity" values="0;0.8;0"
                dur="${duration}s" begin="${delay}s" repeatCount="indefinite"/>
            </circle>
          `);
        }

        return `
          <svg viewBox="0 0 600 400" style="width: 100%; height: 100%;">
            ${snowflakes.join('')}
          </svg>
        `;
      },

      getNewYearSVG() {
        const fireworks = [];
        const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#ff66d9'];

        for (let i = 0; i < 6; i++) {
          const cx = Math.random() * 500 + 50;
          const cy = Math.random() * 300 + 50;
          const color = colors[Math.floor(Math.random() * colors.length)];
          const delay = Math.random() * 2;

          fireworks.push(`
            <g>
              <circle cx="${cx}" cy="${cy}" r="0" fill="${color}" opacity="0.8">
                <animate attributeName="r" values="0;40;0" dur="2s" begin="${delay}s" repeatCount="indefinite"/>
                <animate attributeName="opacity" values="0.8;0;0.8" dur="2s" begin="${delay}s" repeatCount="indefinite"/>
              </circle>
              ${[0, 72, 144, 216, 288].map(angle => `
                <circle cx="${cx}" cy="${cy}" r="2" fill="${color}">
                  <animateTransform attributeName="transform" type="translate"
                    values="0,0; ${Math.cos(angle * Math.PI / 180) * 50},${Math.sin(angle * Math.PI / 180) * 50}"
                    dur="2s" begin="${delay}s" repeatCount="indefinite"/>
                  <animate attributeName="opacity" values="1;0" dur="2s" begin="${delay}s" repeatCount="indefinite"/>
                </circle>
              `).join('')}
            </g>
          `);
        }

        return `
          <svg viewBox="0 0 600 400" style="width: 100%; height: 100%;">
            ${fireworks.join('')}
          </svg>
        `;
      }
    };

    // ==================== Tab Navigation ====================
    const tabNavigation = {
      init() {
        const navItems = document.querySelectorAll('.nav-item');

        navItems.forEach(item => {
          item.addEventListener('click', () => {
            const tab = item.dataset.tab;
            this.switchTab(tab);
          });
        });
      },

      switchTab(tabName) {
        // Update nav items
        document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.toggle('active', item.dataset.tab === tabName);
        });

        // Update content panels
        document.querySelectorAll('.content-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        document.getElementById(`panel-${tabName}`).classList.add('active');

        state.activeTab = tabName;

        // Hide letter detail if switching away from letters
        if (tabName !== 'letters') {
          lettersModule.hideDetail();
        }
      }
    };

    // ==================== Main App ====================
    const app = {
      async init() {
        await dataLoader.loadAll();

        messagesModule.init();
        lettersModule.init();
        lettersModule.setupNavigation();
        cardsModule.init();
        cardModalModule.init();
        tabNavigation.init();
      }
    };

    // ==================== Initialize ====================
    document.addEventListener('DOMContentLoaded', () => {
      // Check if marked.js is loaded
      if (typeof marked === 'undefined') {
        console.warn('marked.js not loaded, letter content will display as plain text');
      } else {
        console.log('marked.js loaded successfully');
      }

      passwordGate.init();
    });
  </script>
</body>
</html>
